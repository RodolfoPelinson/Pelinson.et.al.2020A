---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# pelinson.et.al.2020

<!-- badges: start -->
<!-- badges: end -->

The goal of pelinson.et.al.2020 is to walk the user through the statistical analysis presented in "Pelinson et al 2020. Top predator introduction changes the effects of spatial isolation on freshwater community structure"

## Installation

You can install the released version of pelinson.et.al.2020 from [GitHub](https://github.com/RodolfoPelinson/pelinson.et.al.2020) with:



``` {r installing package, eval = T}
#install.packages("devtools")
#devtools::install_github("RodolfoPelinson/pelinson.et.al.2020")
library(pelinson.et.al.2020)

```
This will give you access to all the data and functions used to produce the results shown in "Pelinson et al 2020. Top predator introduction changes the effects of spatial isolation on freshwater community structure".


## Testing for differences in abundance

This is for testing for differences in the abundance of predatory insects across all treatments and sampling surveys. We used generalized linear mixed models with a negative binomial distribution (`glmer.nb` function from package `lme4`) to fit the models. Then we used `anova` from package `lme4` to compute likelihood ratio tests.

```{r anova_pred, cache=TRUE}
library(lme4)

`pred_no_effect` <- glmer.nb(abundance_predators~ 1 + (1|ID), data = treatments)
`pred_survey` <- glmer.nb(abundance_predators~(survey) + (1|ID), data = treatments)
`pred_fish` <- glmer.nb(abundance_predators~(survey+fish) + (1|ID), data = treatments)
`pred_isolation` <- glmer.nb(abundance_predators~(survey+fish+isolation) + (1|ID), data = treatments)
`pred_survey:fish` <- glmer.nb(abundance_predators~(survey + fish + isolation + survey:fish) + (1|ID), data = treatments)
`pred_survey:isolation` <- glmer.nb(abundance_predators~(survey + fish + isolation + survey:fish + survey:isolation) + (1|ID), data = treatments)
`pred_fish:isolation` <- glmer.nb(abundance_predators~(survey + fish + isolation + survey:fish + survey:isolation + fish:isolation) + (1|ID), data = treatments)
`pred_survey:fish:isolation` <- glmer.nb(abundance_predators~(survey + fish + isolation + survey:fish + survey:isolation + fish:isolation + survey:fish:isolation) + (1|ID), data = treatments)

Anova_predators <- anova(`pred_no_effect`, 
      `pred_survey`,
      `pred_fish`,
      `pred_isolation`,
      `pred_survey:fish`,
      `pred_survey:isolation`,
      `pred_fish:isolation`,
      `pred_survey:fish:isolation`)

Anova_predators
```

Now some *post-hoc* tests using function `emmeans` from package `emmeans` to identify pairwise differences for the effect of sampling survey and isolation, separately. *Post-hoc* tests were always applied to the most complex model to account for the effect of all possible interactions.

```{r, cache = T}
library(emmeans)
emmeans(`pred_survey:fish:isolation`, list(pairwise ~ survey), adjust = "tukey") 
emmeans(`pred_survey:fish:isolation`, list(pairwise ~ isolation), adjust = "tukey") 
```





Same thing now for herbivores and detritivores.

```{r anova_cons, cache=T}
`cons_no_effect` <- glmer.nb(abundance_consumers~ 1 + (1|ID), data = treatments)
`cons_survey` <- glmer.nb(abundance_consumers~(survey) + (1|ID), data = treatments)
`cons_fish` <- glmer.nb(abundance_consumers~(survey+fish) + (1|ID), data = treatments)
`cons_isolation` <- glmer.nb(abundance_consumers~(survey+fish+isolation) + (1|ID), data = treatments)
`cons_survey:fish` <- glmer.nb(abundance_consumers~(survey + fish + isolation + survey:fish) + (1|ID), data = treatments)
`cons_survey:isolation` <- glmer.nb(abundance_consumers~(survey + fish + isolation + survey:fish + survey:isolation) + (1|ID), data = treatments)
`cons_fish:isolation` <- glmer.nb(abundance_consumers~(survey + fish + isolation + survey:fish + survey:isolation + fish:isolation) + (1|ID), data = treatments)
`cons_survey:fish:isolation` <- glmer.nb(abundance_consumers~(survey + fish + isolation + survey:fish + survey:isolation + fish:isolation + survey:fish:isolation) + (1|ID), data = treatments)

Anova_consumers <- anova(`cons_no_effect`, 
      `cons_survey`,
      `cons_fish`,
      `cons_isolation`,
      `cons_survey:fish`,
      `cons_survey:isolation`,
      `cons_fish:isolation`,
      `cons_survey:fish:isolation`)
Anova_consumers

```
Now *post-hoc* tests to identify pairwise differences for the effect of sampling survey, and interaction between isolation and survey, and between isolation and presence of fish:

```{r, cache = T}
emmeans(`cons_survey:fish:isolation`, list(pairwise ~ survey), adjust = "tukey") 
emmeans(`cons_survey:fish:isolation`, list(pairwise ~ isolation|fish), adjust = "tukey") 
emmeans(`cons_survey:fish:isolation`, list(pairwise ~ isolation|survey), adjust = "tukey") 

```

